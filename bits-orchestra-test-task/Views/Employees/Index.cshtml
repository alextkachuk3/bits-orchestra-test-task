@{
    ViewData["Title"] = "Home Page";

    List<Employee> employees = Model;
}

<div class="text-center row">
    @if (employees.Count == 0)
    {
        <p>There are no employees in the database.</p>
    }
    else
    {
        <div class="panel">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th class="col-2">Name</th>
                        <th class="col-2">Date of birth</th>
                        <th class="col-1">Married</th>
                        <th class="col-2">Phone</th>
                        <th class="col-2">Salary</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var employee in employees)
                    {
                        <tr class="paginate-show">
                            <td class="col-2">
                                <input type="text" class="form-control" id="employeeName-@employee.Id" data-id="@employee.Id" value="@employee.Name" />
                            </td>
                            <td class="col-2">
                                <input type="date" class="form-control" id="employeeDOB-@employee.Id" data-id="@employee.Id" value="@employee.DateOfBirth.ToString("yyyy-MM-dd")" />
                            </td>
                            <td class="col-1">
                                <input class="form-check-input" type="checkbox" id="employeeIsMarried-@employee.Id" data-id="@employee.Id" @(employee.IsMarried ? "checked" : "") />
                            </td>
                            <td class="col-2">
                                <input type="text" class="form-control" id="employeePhone-@employee.Id" data-id="@employee.Id" value="@employee.Phone" />
                            </td>
                            <td class="col-2">
                                <input type="number" class="form-control" id="employeeSalary-@employee.Id" data-id="@employee.Id" value="@employee.Salary" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@section Scripts {   
    <script>
        $(document).ready(function () {
            $('input').on('change', function () {
                let employeeId = $(this).data('id');

                let updatedName = $('#employeeName-' + employeeId).val();
                let updatedDOB = $('#employeeDOB-' + employeeId).val();
                let updatedIsMarried = $('#employeeIsMarried-' + employeeId).is(':checked');
                let updatedPhone = $('#employeePhone-' + employeeId).val();
                let updatedSalary = $('#employeeSalary-' + employeeId).val();

                $.ajax({
                    url: '/Employees/UpdateEmployee',
                    method: 'POST',
                    data: {
                        id: employeeId,
                        name: updatedName,
                        dateOfBirth: updatedDOB,
                        isMarried: updatedIsMarried,
                        phone: updatedPhone,
                        salary: updatedSalary
                    },
                    success: function (response) {
                        console.log('Employee updated successfully.');
                    },
                    error: function (xhr, status, error) {
                        console.error('Error occurred: ' + error);
                        alert('Error updating employee.');
                    }
                });
            });
        });
    </script>
}
